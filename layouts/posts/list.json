{{- $pages := .Pages.ByDate.Reverse -}}
{{- $items := slice -}}
{{- range $pages }}
  {{- $item := dict "id" .Permalink "url" .Permalink "title" .Title "date_published" (.Date.Format "2006-01-02T15:04:05-07:00") -}}
  {{- with .Summary }}
    {{- $summaryText := . | plainify -}}
    {{- $item = merge $item (dict "summary" $summaryText "content_text" $summaryText) -}}
  {{- end -}}
  {{- $item = merge $item (dict "content_html" .Content) -}}
  {{- with .Params.tags }}
    {{- $item = merge $item (dict "tags" .) -}}
  {{- end -}}
  {{- $items = $items | append $item -}}
{{- end -}}
{{- $title := printf "%s Posts" site.Title -}}
{{- $feedURL := "/posts/index.json" | absURL -}}
{{- $homeURL := "/posts/" | absURL -}}
{{- $feed := dict "version" "https://jsonfeed.org/version/1.1" "title" $title "home_page_url" $homeURL "feed_url" $feedURL "description" .Params.description "items" $items -}}
{{- $feed | jsonify -}}
